<!DOCTYPE html>
<html lang="zh-cn">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Go语言入门指南 - Gang&#39;s Blog</title>
<meta name="description" content="Explain函数 MySQL 的 EXPLAIN 语句用于分析 SQL 查询的执行计划，帮助开发者理解查询是如何执行的，以及优化查询性能。以下是 EXPLAIN 语句输出各个字段的详细深入解释：
字段意义 测试SQL:
1-- 演员表 2DROP TABLE IF EXISTS `actor`; 3CREATE …">
<meta name="keywords" content="Go, 编程, 教程">
<meta name="author" content="Gang">


<link rel="canonical" href="http://localhost:1313/posts/your-post-name/">


<link rel="stylesheet" href="http://localhost:1313/css/style.css">
<link rel="stylesheet" href="http://localhost:1313/css/syntax.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


<link rel="icon" href="http://localhost:1313/favicon.ico" sizes="any">
<link rel="icon" type="image/svg+xml" href="http://localhost:1313/favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="manifest" href="http://localhost:1313/site.webmanifest">
<meta name="theme-color" content="#4a6cf7">


<meta property="og:title"
  content="Go语言入门指南 - Gang&#39;s Blog">
<meta property="og:description"
  content="Explain函数 MySQL 的 EXPLAIN 语句用于分析 SQL 查询的执行计划，帮助开发者理解查询是如何执行的，以及优化查询性能。以下是 EXPLAIN 语句输出各个字段的详细深入解释：
字段意义 测试SQL:
1-- 演员表 2DROP TABLE IF EXISTS `actor`; 3CREATE …">
<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:1313/posts/your-post-name/">

<meta property="og:image" content="http://localhost:1313/%20images/hero-bg.jpg">

<meta property="og:site_name" content="Gang&#39;s Blog">


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title"
  content="Go语言入门指南 - Gang&#39;s Blog">
<meta name="twitter:description"
  content="Explain函数 MySQL 的 EXPLAIN 语句用于分析 SQL 查询的执行计划，帮助开发者理解查询是如何执行的，以及优化查询性能。以下是 EXPLAIN 语句输出各个字段的详细深入解释：
字段意义 测试SQL:
1-- 演员表 2DROP TABLE IF EXISTS `actor`; 3CREATE …">

<meta name="twitter:image" content="http://localhost:1313/%20images/hero-bg.jpg">




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go语言入门指南",
  "description": "Explain函数 MySQL 的 EXPLAIN 语句用于分析 SQL 查询的执行计划，帮助开发者理解查询是如何执行的，以及优化查询性能。以下是 EXPLAIN 语句输出各个字段的详细深入解释：\n字段意义 测试SQL:\n1-- 演员表 2DROP TABLE IF EXISTS \u0060actor\u0060; 3CREATE …",
  "author": {
    "@type": "Person",
    "name": "Gang"
  },
  "datePublished": "2023-10-15T00:00:00Z",
  "dateModified": "2023-10-15T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http:\/\/localhost:1313\/posts\/your-post-name\/"
  },
  
  "image": "http:\/\/localhost:1313\/images\/hero-bg.jpg",
  
  "publisher": {
    "@type": "Organization",
    "name": "Gang\u0027s Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http:\/\/localhost:1313\/favicon-32x32.png"
    }
  }
}
</script>

</head>

<body>
    <header class="header">
    <div class="container">
        <div class="header-inner">
            <a href="http://localhost:1313/" class="logo">
                <h1>Gang&#39;s Blog</h1>
            </a>
            <div class="header-right">
                <div class="search-box">
                    <form action="http://localhost:1313/%20search" method="get">
                        <input type="text" name="q" placeholder="搜索..." aria-label="搜索">
                        <button type="submit" aria-label="提交搜索"><i class="fas fa-search"></i></button>
                    </form>
                </div>
                <nav class="nav">
                    
                    
                    
                    
                    
                    
                    
                    <a href="http://localhost:1313/" class="nav-link">首页</a>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <a href="http://localhost:1313/posts/" class="nav-link active">文章</a>
                    
                    
                    
                    
                    
                    
                    
                    <a href="http://localhost:1313/photos/" class="nav-link">照片墙</a>
                    
                    
                    
                    
                    
                    
                    
                    <a href="http://localhost:1313/timeline/" class="nav-link">时间线</a>
                    
                    
                    
                    
                    
                    
                    
                    <a href="http://localhost:1313/tags/" class="nav-link">标签</a>
                    
                    
                    
                    
                    
                    
                    
                    <a href="http://localhost:1313/about/" class="nav-link">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>
    <main class="main">
        <div class="container">
            <article class="post">
                <header class="post-header">
                    <h1 class="post-title">Go语言入门指南</h1>
                    <div class="post-meta">
                        <time datetime=" 2023-10-15T00:00:00Z">
                            2023-10-15
                        </time>

                        
                        <span class="post-category">
                            <i class="fas fa-folder"></i>
                            
                            <a href="http://localhost:1313/%20categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/">编程技术</a>
                            
                        </span>
                        

                        

                        <span class="post-reading-time">
                            <i class="fas fa-clock"></i> 13 分钟阅读
                        </span>
                    </div>

                    
                    <div class="post-tags">
                        
                        <a href='http://localhost:1313/tags/go/' class="tag">Go</a>
                        
                        <a href='http://localhost:1313/tags/%E7%BC%96%E7%A8%8B/' class="tag">编程</a>
                        
                        <a href='http://localhost:1313/tags/%E6%95%99%E7%A8%8B/' class="tag">教程</a>
                        
                    </div>
                    
                </header>

                <div class="post-content">
                    <h1 id="explain函数">Explain函数</h1>
<p>MySQL 的 <code>EXPLAIN</code> 语句用于分析 SQL 查询的执行计划，帮助开发者理解查询是如何执行的，以及优化查询性能。以下是 <code>EXPLAIN</code> 语句输出各个字段的详细深入解释：</p>
<br/>
<h2 id="字段意义">字段意义</h2>
<p>测试SQL:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 演员表
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">actor</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">actor</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">update_time</span><span class="o">`</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">actor</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">update_time</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;2017-12-22 15:27:18&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;2017-12-22 15:27:18&#39;</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;2017-12-22 15:27:18&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="c1">-- 电影表
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">film</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">film</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_name</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">film</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;film0&#39;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;film1&#39;</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;film2&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w"></span><span class="c1">-- 电影和演员关联表
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="o">`</span><span class="n">film_actor</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">film_actor</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">film_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">actor_id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w"> </span><span class="o">`</span><span class="n">remark</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_film_actor_id</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">film_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">actor_id</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="n">film_actor</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">film_id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">actor_id</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><br/>
<h3 id="1-id">1. <code>id</code></h3>
<ul>
<li><strong>定义</strong>：查询中每个子查询的标识符。</li>
<li><strong>作用</strong>：标识执行顺序和执行的层次。通常情况下，<code>id</code> 值越大，优先级越低。<code>id</code> 相同的表示同一级别的查询，可以并行执行。<code>id</code>为null的最后执行</li>
</ul>
<br/>
<h3 id="2-select_type">2. <code>select_type</code></h3>
<ul>
<li><strong>定义</strong>：查询的类型，表示查询中各个部分的类别。</li>
<li><strong>常见值</strong>：
<ul>
<li><code>SIMPLE</code>：简单查询，不包含子查询或 UNION。</li>
<li><code>PRIMARY</code>：最外层的查询。</li>
<li><code>UNION</code>：UNION 中的第二个或后续查询。</li>
<li><code>DEPENDENT UNION</code>：依赖于外部查询的 UNION 查询。</li>
<li><code>UNION RESULT</code>：UNION 的结果。</li>
<li><code>SUBQUERY</code>：子查询中的第一个 SELECT。</li>
<li><code>DEPENDENT SUBQUERY</code>：依赖于外部查询的子查询。</li>
<li><code>DERIVED</code>：派生表的查询，如 FROM 子句中的子查询。</li>
<li><code>MATERIALIZED</code>：物化子查询，通常在优化子查询时使用。</li>
</ul>
</li>
</ul>
<br/>
<h3 id="3-table">3. <code>table</code></h3>
<ul>
<li><strong>定义</strong>：查询涉及的表名或别名。</li>
<li><strong>作用</strong>：指出当前正在访问或处理的表。</li>
</ul>
<br/>
<h3 id="4-partitions">4. <code>partitions</code></h3>
<ul>
<li><strong>定义</strong>：分区信息。</li>
<li><strong>作用</strong>：显示查询涉及的表的分区，如果表进行了分区。</li>
</ul>
<br/>
<h3 id="5-type">5. <code>type</code></h3>
<ul>
<li>
<p><strong>定义</strong>：连接类型，表示 MySQL 如何查找行。</p>
</li>
<li>
<p><strong>重要值</strong>：</p>
<ul>
<li>
<p><code>null</code>: myslq能够在优化阶段分解查询语句, 在之心该阶段用不着再访问表或者索引, 例如: 获取索引列中的最小值等</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+------+-------+-------------------------+------------------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                        </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+------+-------+-------------------------+------------------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">                         </span><span class="o">|</span><span class="w"> </span><span class="k">Select</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">away</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+------+-------+-------------------------+------------------------------+
</span></span></span></code></pre></div></li>
<li>
<p><code>system</code>：表只有一行（等同于 system 表）。</p>
</li>
<li>
<p><code>const</code>：表最多有一行匹配，常用于主键或唯一索引。</p>
</li>
<li>
<p><code>eq_ref</code>：对于每个来自前一个表的行，只有一行被读出，通常用于<strong>主键(如下面的film.id)<strong>或</strong>唯一索引</strong>的连接。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film_actor</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">film</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">film_actor</span><span class="p">.</span><span class="n">film_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">film</span><span class="p">.</span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+--------------------------------------+---------+------------------------------------+------+----------+-------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                                  </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">                                </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+--------------------------------------+---------+------------------------------------+------+----------+-------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film_actor</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">   </span><span class="o">|</span><span class="w">                   </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">                                    </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film</span><span class="w">        </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">eq_ref</span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">                              </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">explain_test</span><span class="p">.</span><span class="n">film_actor</span><span class="p">.</span><span class="n">film_id</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+--------------------------------------+---------+------------------------------------+------+----------+-------+
</span></span></span></code></pre></div></li>
<li>
<p><code>ref</code>：相比 eq_ref，不使用唯一索引，而是使用普通索引或者唯一性索引的部分前缀，索引要和某个值相比较，可能会找到多个符合条件的行。</p>
<ul>
<li>
<p>简单的select查询, name是普通索引</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;film1&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+--------------+---------+---------+-----+------+----------+-----------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+--------------+---------+---------+-----+------+----------+-----------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="o">|</span><span class="w"> </span><span class="mi">33</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w">     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+--------------+---------+---------+-----+------+----------+-----------------+
</span></span></span></code></pre></div></li>
<li>
<p>关联表查询，<code>idx_film_actor_id</code>是<code>film_id</code>和<code>actor_id</code>的联合索引，这里使用到了<code>film_actor</code>的左边前缀<code>film_id</code>部分。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">film_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film</span><span class="w"> </span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">film_actor</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">film</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">film_actor</span><span class="p">.</span><span class="n">film_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+-------------------+---------+------------------------+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+-------------------+---------+------------------------+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film</span><span class="w">        </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mi">33</span><span class="w">      </span><span class="o">|</span><span class="w">                        </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film_actor</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">idx_film_actor_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_film_actor_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">explain_test</span><span class="p">.</span><span class="n">film</span><span class="p">.</span><span class="n">id</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+-------------------+---------+------------------------+------+----------+------------------+
</span></span></span></code></pre></div></li>
</ul>
</li>
<li>
<p><code>range</code>：范围扫描通常出现在 in(), between ,&gt; ,&lt;, &gt;= 等操作中。使用一个索引来检索给定范围的行。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">actor</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">actor</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span></code></pre></div></li>
<li>
<p><code>index</code>：Full Index Scan，index与ALL区别为index类型只遍历索引树,扫描全索引就能拿到结果，一般是扫描某个二级索引，这种扫描不会从索引树根节点开始快速查找，而是直接对二级索引的叶子节点遍历和扫描，速度还是比较慢的，这种查询一般为使用<strong>覆盖索引</strong>，二级索引一般比较小，所以这种通常比ALL快一些。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">33</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span></code></pre></div></li>
<li>
<p><code>ALL</code>：全表扫描。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">33</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>一般来说, 得保证查询至少要达到range级别, 最好达到ref</p>
</li>
</ul>
<br/>
<h3 id="6-possible_keys">6. <code>possible_keys</code></h3>
<ul>
<li><strong>定义</strong>：查询中可能使用的索引。</li>
<li><strong>作用</strong>：显示查询优化器认为可能有效的索引。explain 时可能出现 possible_keys 有列，而 key 显示 NULL 的情况，这种情况是因为表中数据不多，mysql认为索引对此查询帮助不大，选择了全表查询。如果该列是NULL，则没有相关的索引。在这种情况下，可以通过检查 where 子句看是否可以创造一个适当的索引来提高查询性能，然后用 explain 查看效果。</li>
</ul>
<br/>
<h3 id="7-key">7. <code>key</code></h3>
<ul>
<li>
<p><strong>定义</strong>：查询实际使用的索引。</p>
</li>
<li>
<p><strong>作用</strong>：优化器选择的用于执行查询的索引。</p>
<p>这一列显示了mysql在索引里使用的字节数，通过这个值可以算出具体使用了索引中的哪些列。</p>
<p>举例来说，film_actor的联合索引 idx_film_actor_id 由 film_id 和 actor_id 两个int列组成，并且每个int是4字节。通</p>
<p>过结果中的key_len=4可推断出查询使用了第一个列：film_id列来执行索引查找。</p>
<p>key_len计算规则如下：</p>
<ul>
<li>
<p>字符串，char(n)和varchar(n)，5.0.3以后版本中，**n均代表字符数，而不是字节数，**如果是utf-8，一个数字或字母占1个字节，一个汉字占3个字节</p>
<ul>
<li>char(n)：如果存汉字长度就是 3n 字节</li>
<li>varchar(n)：如果存汉字则长度是 3n + 2 字节，加的2字节用来存储字符串长度，因为</li>
</ul>
<p>varchar是变长字符串</p>
</li>
<li>
<p>数值类型</p>
<ul>
<li>tinyint：1字节</li>
<li>smallint：2字节</li>
<li>int：4字节</li>
<li>bigint：8字节</li>
</ul>
</li>
<li>
<p>时间类型</p>
<ul>
<li>date：3字节</li>
<li>timestamp：4字节</li>
<li>datetime：8字节</li>
</ul>
</li>
<li>
<p>如果字段允许为 NULL，需要1字节记录是否为 NULL</p>
</li>
</ul>
<p>索引最大长度是768字节，当字符串过长时，mysql会做一个类似左前缀索引的处理，将前半部分的字符提取出来做索引。</p>
</li>
</ul>
<br/>
<h3 id="8-key_len">8. <code>key_len</code></h3>
<ul>
<li><strong>定义</strong>：使用的索引的长度。</li>
<li><strong>作用</strong>：显示查询使用的索引的字节长度，越短越好。</li>
</ul>
<br/>
<h3 id="9-ref">9. <code>ref</code></h3>
<ul>
<li><strong>定义</strong>：显示使用哪个列或常量与 key 一起用于查找行。</li>
<li><strong>作用</strong>：表示索引列与之比较的值或列。</li>
</ul>
<br/>
<h3 id="10-rows">10. <code>rows</code></h3>
<ul>
<li><strong>定义</strong>：MySQL <strong>估计</strong>要读取的行数。</li>
<li><strong>作用</strong>：用于估计查询的成本，行数越少，查询性能越好。</li>
</ul>
<br/>
<h3 id="11-filtered">11. <code>filtered</code></h3>
<ul>
<li><strong>定义</strong>：显示在存储引擎层过滤掉的行的百分比。</li>
<li><strong>作用</strong>：估计剩余的行数比例。</li>
</ul>
<br/>
<h3 id="12-extra">12. <code>Extra</code></h3>
<ul>
<li>
<p><strong>定义</strong>：执行计划的附加信息。</p>
</li>
<li>
<p><strong>常见值</strong>：</p>
<ul>
<li>
<p><code>Using where</code>：使用 WHERE 子句过滤行。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">film_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film_actor</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">film_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">actor</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">33</span><span class="p">.</span><span class="mi">33</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span></code></pre></div></li>
<li>
<p><code>Using index</code>：查询仅使用索引，不读取实际的行数据。使用覆盖索引</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">film_id</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film_actor</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">film_id</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+-------------------+---------+-------+----------+------------------------+-------------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+-------------------+---------+-------+----------+------------------------+-------------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film_actor</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_film_actor_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_film_actor_id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w">       </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="p">;</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------------+------------+-------+-------------------+-------------------+---------+-------+----------+------------------------+-------------------------+
</span></span></span></code></pre></div></li>
<li>
<p><code>Using temporary</code>：使用临时表保存中间结果。</p>
<ul>
<li>
<p><code>actor.name</code>没有索引, 此时创建了张临时表</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">actor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">actor</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">temporary</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span></code></pre></div></li>
<li>
<p><code>fim.name</code>有个<code>idx_name</code>的索引, 此时使用的<code>using index</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">distinct</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">film</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">33</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">3</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+-------+---------------+----------+---------+-----+------+----------+----------------------+
</span></span></span></code></pre></div></li>
</ul>
</li>
<li>
<p><code>Using filesort</code>：将用外部排序而不是索引排序，数据较小时从内存排序，否则需要在磁盘完成排序。这种情况下一般也是要考虑使用索引来优化的。</p>
</li>
<li>
<p><code>Using join buffer</code>：使用连接缓存。</p>
</li>
<li>
<p><code>Impossible WHERE</code>：WHERE 子句永远为 false，返回空结果集。</p>
</li>
<li>
<p><code>Select tables optimized away</code>：优化器消除了不必要的表查询。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">film</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+-------------------------+
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                   </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+-------------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">Select</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">away</span><span class="w">  </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+---------------+----+---------+-----+------+----------+-------------------------+
</span></span></span></code></pre></div></li>
</ul>
</li>
</ul>
<br/>
<br/>
<h1 id="最佳实践">最佳实践</h1>
<br/>
<h2 id="最佳实践-1">最佳实践</h2>
<br/>
<h3 id="1-全值匹配">1. 全值匹配</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">                     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">78</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="p">,</span><span class="n">const</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">                     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------+------+----------+---------------------+
</span></span></span></code></pre></div><br/>
<h3 id="2-最左前缀法则">2. 最左前缀法则</h3>
<p>查询从索引的最左前列开始并且不跳过索引中的列</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Bill&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">78</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="p">,</span><span class="n">const</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">                     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dev&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;manager&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span></code></pre></div><br/>
<h3 id="3-不在索引列上做任何计算操作计算函数自动或手动类型转换">3. 不在索引列上做任何计算操作（计算、函数、自动或手动类型转换）</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">                     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="n">mysql</span><span class="o">&gt;</span><span class="w"> </span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">left</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="c1">-- 给hire_time增加一个普通索引： 
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">employees</span><span class="o">`</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="o">`</span><span class="n">idx_hire_time</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">hire_time</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span><span class="w"> </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="nb">date</span><span class="p">(</span><span class="n">hire_time</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;2018-09-30&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w">               </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------+----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1">-- 还原最初状态
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">employees</span><span class="o">`</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="o">`</span><span class="n">idx_hire_time</span><span class="o">`</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><br/>
<h3 id="4-不能使用索引中范围条件右边的列">4. 不能使用索引中范围条件右边的列</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">               </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">140</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="p">,</span><span class="n">const</span><span class="p">,</span><span class="n">const</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">                     </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-------------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+-------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+-------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">78</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">condition</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+-------+----------+----------------------+
</span></span></span></code></pre></div><p>上面例子中的第二条position没有走索引，因为在满足age&gt;22的条件下，不能保证manager都是有序的</p>
<br/>
<h3 id="5-尽量使用覆盖索引只访问索引的查询索引列包含查询列减少select-">5. 尽量使用覆盖索引，只访问索引的查询（索引列包含查询列），减少select *</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+------------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+------------------+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">140</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="p">,</span><span class="n">const</span><span class="p">,</span><span class="n">const</span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w">         </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+------------------+------+----------+---------------------+
</span></span></span></code></pre></div><br/>
<h3 id="6-在使用不等于not-innot-exists的时候无法使用索引">6. 在使用不等于(≠，&lt;&gt;)，not in，not exists的时候无法使用索引</h3>
<p><code>&lt; 小于</code>、 <code>&gt; 大于</code>、 <code>&lt;=</code>、<code>&gt;=</code> 这些，mysql内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 当employees表只有3条数据时
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+-------+----------+----------------------+
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+-------+----------+----------------------+
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">condition</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+-------+----------+----------------------+
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">-- 当employees表有20w条数据时
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+----+---------+-----+--------+----------+------------------+
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+----+---------+-----+--------+----------+------------------+
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w">    </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">199696</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+----+---------+-----+--------+----------+------------------+
</span></span></span></code></pre></div><br/>
<h3 id="7--is-nullis-not-null-一般情况下也无法使用索引">7.  <code>is null</code>，<code>is not null</code> 一般情况下也无法使用索引</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">null</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+----------------+-----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+----------------+-----+---------+-----+------+----------+------------------+
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">                </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w">      </span><span class="o">|</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">Impossible</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-------+------------+------+----------------+-----+---------+-----+------+----------+------------------+
</span></span></span></code></pre></div><br/>
<h3 id="8-like以通配符开头abc无法使用索引">8. like以通配符开头（<code>%abc…</code>）无法使用索引</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%Lei&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+----------------+-----+---------+-------+--------+----------+----------------+
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">          </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+----------------+-----+---------+-------+--------+----------+----------------+
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w">                </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">199696</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">11</span><span class="p">.</span><span class="mi">11</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">    </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+----------------+-----+---------+-------+--------+----------+----------------+
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="c1">-- 可以走索引
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;Lei%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="w">      </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+------+----------+----------------------+
</span></span></span></code></pre></div><p>使用覆盖索引，查询字段必须是建立<strong>覆盖索引字段</strong> , 解决<code>like '%字符串%'</code>索引不被使用的问题</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="k">position</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%Lei%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+--------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+--------+----------+----------------------+
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">140</span><span class="w">     </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">199696</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">11</span><span class="p">.</span><span class="mi">11</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="p">;</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+---------------------------+---------------------------+---------+-----+--------+----------+----------------------+
</span></span></span></code></pre></div><br/>
<h3 id="9-字符串不加单引号导致索引失效">9. 字符串不加单引号，导致索引失效</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1000&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+------+--------+----------+-------+
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+------+--------+----------+-------+
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">const</span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w">       </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+------+--------+----------+-------+
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="c1">-- 走的全表查询
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-----+--------+----------+------------------+
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                       </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-----+--------+----------+------------------+
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">     </span><span class="o">|</span><span class="w">                           </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">199696</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">10</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+---------------------------+---------+-----+--------+----------+------------------+
</span></span></span></code></pre></div><br/>
<h3 id="10-少用orin他们不一定使用索引">10. 少用or，in，他们不一定使用索引，</h3>
<p>mysql内部优化器会更具检索比例，表的大小等多个因素来整体评估是否使用索引。</p>
<br/>
<h3 id="11-范围查询">11. 范围查询</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 走全表
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;=</span><span class="mi">100000</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+-----+---------+-----+--------+----------+------------------+
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">            </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+-----+---------+-----+--------+----------+------------------+
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">ALL</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_age</span><span class="w">                   </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w">         </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">199696</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">where</span><span class="w">      </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+------+---------------------------+-----+---------+-----+--------+----------+------------------+
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="c1">-- 走索引
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span><span class="k">explain</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+----------------+---------+---------+-----+-------+----------+---------------------------------+
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">                           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+----------------+---------+---------+-----+-------+----------+---------------------------------+
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_age</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">idx_age</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">       </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">38352</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">00</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">condition</span><span class="w">           </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+----------------+---------+---------+-----+-------+----------+---------------------------------+
</span></span></span></code></pre></div><p>没走索引原因：mysql内部优化器会根据检索比例、表大小等多个因素整体评估是否使用索引。</p>
<p>比如这个例子，可能是由于单次数据量查询过大导致优化器最终选择不走索引。</p>
<p>优化方法：可以将大的范围拆分成多个小范围。</p>
<p><br/><br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">employees</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;姓名&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">age</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;年龄&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">  </span><span class="o">`</span><span class="k">position</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;职位&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">hire_time</span><span class="o">`</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;入职时间&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">  </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="n">idx_name_age_position</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">age</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="k">position</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">BTREE</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="w"> </span><span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;员工记录表&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="k">position</span><span class="p">,</span><span class="n">hire_time</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;LiLei&#39;</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="s1">&#39;manager&#39;</span><span class="p">,</span><span class="n">NOW</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="k">position</span><span class="p">,</span><span class="n">hire_time</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;HanMeimei&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;dev&#39;</span><span class="p">,</span><span class="n">NOW</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">employees</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="k">position</span><span class="p">,</span><span class="n">hire_time</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;Lucy&#39;</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="s1">&#39;dev&#39;</span><span class="p">,</span><span class="n">NOW</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w"></span><span class="c1">-- 插入一些示例数据
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">insert_emp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w"></span><span class="k">delimiter</span><span class="p">;;</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">insert_emp</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">	</span><span class="k">DECLARE</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="nb">INT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">	</span><span class="k">SET</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">	</span><span class="n">WHILE</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DO</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w">		</span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">NAME</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="p">)</span><span class="k">VALUES</span><span class="p">(</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;lisi&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dev&#39;</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">		</span><span class="k">SET</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">	
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">	</span><span class="k">END</span><span class="w"> </span><span class="n">WHILE</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w"></span><span class="k">END</span><span class="p">;;</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w"></span><span class="k">delimiter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w"></span><span class="k">CALL</span><span class="w"> </span><span class="n">insert_emp</span><span class="w"> </span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="w"></span><span class="c1">-- mysql5.7关闭ONLY_FULL_GROUP_BY报错
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="c1">-- select version(), @@sql_mode;SET sql_mode=(SELECT REPLACE(@@sql_mode,&#39;ONLY_FULL_GROUP_BY&#39;,&#39;&#39;));
</span></span></span></code></pre></div><br/>
<h2 id="测试例子">测试例子</h2>
<blockquote>
<p>联合索引第一个字段是范围的不走索引</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="c1">----+-------------------+----------+------------+------+------------------------+------------------------+----------+-----+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"></span><span class="n">id</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span><span class="c1">----+-------------------+----------+------------+------+------------------------+------------------------+----------+-----+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="c1"></span><span class="mi">1</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="w">       </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">33</span><span class="p">.</span><span class="mi">33</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">condition</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="w"></span><span class="c1">----+-------------------+----------+------------+------+------------------------+------------------------+----------+-----+------+----------+---------------------+
</span></span></span></code></pre></div><p>MySQL会认为结果集应该比较大, 回表效率不高, 不如直接走全表</p>
<br>
<blockquote>
<p>强制走索引(针对上面的情况)</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">EXPLAIN</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="k">force</span><span class="w"> </span><span class="k">index</span><span class="p">(</span><span class="n">idx_name_age_position</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;LiLei&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">position</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+------------------------+------------------------+----------+-----+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select_type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">table</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">partitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">type</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">possible_keys</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">key</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="n">key_len</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Extra</span><span class="w">               </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+------------------------+------------------------+----------+-----+------+----------+---------------------+
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="c1"></span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="k">SIMPLE</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="n">employees</span><span class="w"> </span><span class="o">|</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">idx_name_age_position</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mi">74</span><span class="w">       </span><span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">00</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">condition</span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="w"></span><span class="o">+</span><span class="c1">----+-------------+-----------+------------+-------+------------------------+------------------------+----------+-----+------+----------+---------------------+
</span></span></span></code></pre></div><p>虽然看上去走了索引了, 但是效率不一定高, 因为需要大量的回表。</p>


                    <div class="content-end">
                        <div class="end-line"></div>
                        <div class="end-text">— END —</div>
                    </div>
                </div>

                <div class="post-extra">
                    
                    <div class="extra-section">
                        <div class="extra-title">相关标签</div>
                        <div class="tags-list">
                            
                            <a href='http://localhost:1313/tags/go/' class="tag-link">Go</a>
                            
                            <a href='http://localhost:1313/tags/%E7%BC%96%E7%A8%8B/' class="tag-link">编程</a>
                            
                            <a href='http://localhost:1313/tags/%E6%95%99%E7%A8%8B/' class="tag-link">教程</a>
                            
                        </div>
                    </div>
                    

                    <div class="extra-section">
                        <div class="extra-title">推荐阅读</div>
                        <div class="recommend-grid">
                            
                            
                            
                            <a href="http://localhost:1313/photos/sample-photo-5/" class="recommend-card">
                                <div class="recommend-image">
                                    
                                    <div class="recommend-placeholder"></div>
                                    
                                </div>
                                <div class="recommend-info">
                                    <div class="recommend-title">海滨日落</div>
                                    <div class="recommend-date">2023-10-05</div>
                                </div>
                            </a>
                            
                            <a href="http://localhost:1313/photos/sample-photo-3/" class="recommend-card">
                                <div class="recommend-image">
                                    
                                    <div class="recommend-placeholder"></div>
                                    
                                </div>
                                <div class="recommend-info">
                                    <div class="recommend-title">花卉特写</div>
                                    <div class="recommend-date">2023-10-05</div>
                                </div>
                            </a>
                            
                            <a href="http://localhost:1313/photos/sample-photo-2/" class="recommend-card">
                                <div class="recommend-image">
                                    
                                    <div class="recommend-placeholder"></div>
                                    
                                </div>
                                <div class="recommend-info">
                                    <div class="recommend-title">城市夜景</div>
                                    <div class="recommend-date">2023-09-20</div>
                                </div>
                            </a>
                            
                            <a href="http://localhost:1313/photos/sample-photo-4/" class="recommend-card">
                                <div class="recommend-image">
                                    
                                    <div class="recommend-placeholder"></div>
                                    
                                </div>
                                <div class="recommend-info">
                                    <div class="recommend-title">城市夜景</div>
                                    <div class="recommend-date">2023-09-20</div>
                                </div>
                            </a>
                            
                            
                        </div>
                    </div>
                </div>

                <div class="post-footer">
                    <div class="post-nav">
                        
                        <a href="http://localhost:1313/posts/2022-05-04-c&#43;&#43;%E7%BB%93%E6%9E%84%E4%BD%93/" class="post-nav-prev">
                            <i class="fas fa-arrow-left"></i>
                            <span>C&#43;&#43;结构体和联合体</span>
                        </a>
                        

                        
                        <a href="http://localhost:1313/posts/go-gc-deep-dive/" class="post-nav-next">
                            <span>深入理解Go语言垃圾回收机制：原理、流程与优化</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                        
                    </div>
                </div>
            </article>

            
            <div class="toc-container" id="tocContainer">
                <div class="toc-header">
                    <span><i class="fas fa-list"></i> 目录</span>
                    <button class="toc-hide-btn" id="tocHideBtn" title="收起目录">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <nav class="toc-nav" id="tocNav">
                    
                </nav>
            </div>
        </div>
    </main>

    <footer class="footer">
    <div class="container">
        <div class="footer-inner">
            <div class="footer-info">
                <p>&copy; 2025 Gang&#39;s Blog. All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

    <a href="#" class="back-to-top" id="backToTop" aria-label="返回顶部">
        <i class="fas fa-arrow-up"></i>
    </a>

    
    <button class="toc-show-btn" id="tocShowBtn" title="显示目录" style="display: none;">
        <i class="fas fa-list"></i>
    </button>

    <script>
        
        document.addEventListener('DOMContentLoaded', function () {
            var backToTop = document.getElementById('backToTop');

            window.addEventListener('scroll', function () {
                if (window.pageYOffset > 300) {
                    backToTop.classList.add('show');
                } else {
                    backToTop.classList.remove('show');
                }
            });

            backToTop.addEventListener('click', function (e) {
                e.preventDefault();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            
            document.querySelectorAll('.highlight').forEach(function (highlight) {
                
                if (!highlight.querySelector('.copy-button')) {
                    let copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.textContent = '复制';

                    highlight.appendChild(copyButton);

                    copyButton.addEventListener('click', function () {
                        let codeElement = highlight.querySelector('code');
                        let textToCopy = codeElement.textContent;

                        navigator.clipboard.writeText(textToCopy).then(function () {
                            copyButton.textContent = '已复制!';
                            setTimeout(function () {
                                copyButton.textContent = '复制';
                            }, 2000);
                        }).catch(function (err) {
                            console.error('无法复制文本: ', err);
                        });
                    });
                }

                
                let codeClass = highlight.querySelector('code').className;
                let langMatch = codeClass.match(/language-(\w+)/);

                if (langMatch && langMatch[1]) {
                    let lang = langMatch[1];
                    
                    let existingIndicator = highlight.querySelector('.language-indicator');
                    if (existingIndicator) {
                        existingIndicator.remove();
                    }

                    
                    let langIndicator = document.createElement('div');
                    langIndicator.className = 'language-indicator';
                    langIndicator.textContent = lang;
                    highlight.insertBefore(langIndicator, highlight.firstChild);
                }
            });

            
            const tocContainer = document.getElementById('tocContainer');
            const tocNav = document.getElementById('tocNav');
            const postContent = document.querySelector('.post-content');

            if (!postContent) return;

            
            function addHeadingNumbers() {
                const headings = postContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
                let counters = [0, 0, 0, 0, 0, 0]; 

                headings.forEach(heading => {
                    const level = parseInt(heading.tagName.charAt(1)) - 1; 

                    
                    counters[level]++;

                    
                    for (let i = level + 1; i < counters.length; i++) {
                        counters[i] = 0;
                    }

                    
                    let numberStr = '';
                    for (let i = 0; i <= level; i++) {
                        if (counters[i] > 0) {
                            numberStr += (numberStr ? '.' : '') + counters[i];
                        }
                    }
                    numberStr += '. ';

                    
                    const numberSpan = document.createElement('span');
                    numberSpan.className = 'heading-number';
                    numberSpan.textContent = numberStr;
                    heading.insertBefore(numberSpan, heading.firstChild);
                });
            }

            
            function generateTOC() {
                const headings = postContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
                if (headings.length === 0) {
                    tocContainer.style.display = 'none';
                    return;
                }

                tocNav.innerHTML = '';
                let levelStack = [];

                headings.forEach((heading, index) => {
                    const level = parseInt(heading.tagName.charAt(1));
                    const id = heading.id || `heading-${index}`;
                    heading.id = id;

                    
                    while (levelStack.length > 0 && levelStack[levelStack.length - 1].level >= level) {
                        levelStack.pop();
                    }

                    const listItem = document.createElement('li');
                    listItem.className = `toc-item toc-level-${level}`;

                    const link = document.createElement('a');
                    link.href = `#${id}`;
                    link.className = 'toc-link';
                    link.setAttribute('data-target', id);
                    link.innerHTML = `<span class="toc-text">${heading.textContent}</span>`;

                    listItem.appendChild(link);

                    
                    if (levelStack.length === 0) {
                        tocNav.appendChild(listItem);
                    } else {
                        const parent = levelStack[levelStack.length - 1];
                        let subList = parent.element.querySelector('ul');
                        if (!subList) {
                            subList = document.createElement('ul');
                            subList.className = 'toc-list';
                            parent.element.appendChild(subList);

                            
                            const parentLink = parent.element.querySelector('.toc-link');
                            if (parentLink && !parentLink.classList.contains('toc-expandable')) {
                                parentLink.classList.add('toc-expandable');
                                parentLink.addEventListener('click', function (e) {
                                    if (e.target.closest('.toc-link') === this) {
                                        e.preventDefault();
                                        subList.classList.toggle('toc-collapsed');
                                        this.classList.toggle('toc-expanded');
                                    }
                                });
                            }
                        }
                        subList.appendChild(listItem);
                    }

                    levelStack.push({ level: level, element: listItem });
                });
            }

            
            function updateActiveHeading() {
                const headings = postContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;

                let activeHeading = null;
                let closestHeading = null;
                let closestDistance = Infinity;

                
                headings.forEach(heading => {
                    const rect = heading.getBoundingClientRect();
                    const headingCenter = rect.top + rect.height / 2;
                    const viewportCenter = windowHeight / 2;
                    const distance = Math.abs(headingCenter - viewportCenter);

                    
                    if (headingCenter <= viewportCenter && distance < closestDistance) {
                        closestDistance = distance;
                        closestHeading = heading;
                    }
                });

                activeHeading = closestHeading;

                
                if (!activeHeading) {
                    const isNearBottom = (scrollTop + windowHeight) >= documentHeight - 100;
                    if (isNearBottom && headings.length > 0) {
                        activeHeading = headings[headings.length - 1];
                    }
                }

                
                document.querySelectorAll('.toc-link').forEach(link => {
                    link.classList.remove('active');
                    link.parentElement.classList.remove('active');
                });

                
                if (activeHeading) {
                    const activeLink = document.querySelector(`[data-target="${activeHeading.id}"]`);
                    if (activeLink) {
                        activeLink.classList.add('active');
                        activeLink.parentElement.classList.add('active');

                        
                        let parent = activeLink.parentElement.parentElement;
                        while (parent && parent.classList.contains('toc-list')) {
                            parent.style.display = 'block';
                            parent = parent.parentElement.parentElement;
                        }
                    }
                }
            }

            
            document.addEventListener('click', function (e) {
                if (e.target.closest('.toc-link')) {
                    e.preventDefault();
                    const targetId = e.target.closest('.toc-link').getAttribute('data-target');
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 100;
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                }
            });

            
            addHeadingNumbers(); 
            generateTOC(); 
            updateActiveHeading();

            
            const tocHideBtn = document.getElementById('tocHideBtn');
            const tocShowBtn = document.getElementById('tocShowBtn');

            if (tocHideBtn) {
                tocHideBtn.addEventListener('click', function () {
                    
                    tocContainer.classList.add('hidden');
                    if (tocShowBtn) {
                        tocShowBtn.style.display = 'block';
                    }
                });
            }

            if (tocShowBtn) {
                tocShowBtn.addEventListener('click', function () {
                    
                    tocContainer.classList.remove('hidden');
                    tocShowBtn.style.display = 'none';
                });
            }

            
            let ticking = false;
            window.addEventListener('scroll', function () {
                if (!ticking) {
                    requestAnimationFrame(function () {
                        updateActiveHeading();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        });
    </script>
</body>

</html>